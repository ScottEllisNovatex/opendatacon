<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OpenDataCon</title>

    <script src= "/js/jquery.min.js"> </script>
    <script src= "/js/bootstrap.min.js"> </script>
    <script src="/js/datatables.min.js"></script>
    <script src="/js/bootstrap-treeview.min.js"></script>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/datatables.min.css">
  </head>

  <body>
    <!-- html section -->
    <!-- toggle between web and console mode -->
    <div class="alert alert-info clearfix">
      <a href="#" class="alert-link"></a>
      <button type="button" class="btn btn-primary float-right" onclick="go_to_console()">Console</button>
    </div>

    <!-- Data ports table -->
    <h1 style="text-align:center"> Data Ports </h1>
    <table id="DataPortsTable" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
      <thead>
        <tr id="DataPortsTableHeader">
          <th>Port Name</th>
        </tr>
      </thead>
      <tbody id="DataPortsTableBody"/>
    </table>

    <!-- Data connectors table -->
    <h1 style="text-align:center">Data Connectors</h1>
    <table id="DataConnectorsTable" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
      <thead>
        <tr id="DataConnectorsTableHeader">
          <th>Connector Name</th>
        </tr>
      </thead>
      <tbody id="DataConnectorsTableBody"/>
    </table>

    <!-- Modal for displaying short text -->
    <div class="modal fade" id="short_text_modal">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">
              <div id="short_text_modal_title"></div>
            </h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <div id="short_text_modal_data"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Responsive modal with medium size which can display an embeded page in iframe for statistics and configuration -->
    <div class="modal fade" id="frame_modal" tabindex="-1" role="dialog" aria-labelledby="frame_modal_label" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">
              <div id="frame_modal_title"></div>
            </h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body mb-0 p-0">
            <div class="embed-responsive embed-responsive-16by9 z-depth-1-half">
              <iframe class="embed-responsive-item" id="frame_src" src="" allowfullscreen></iframe>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- java script section -->
    <script>
      /* function which will take user to the console mode */
      function go_to_console() {
          window.location.href="console.html";
      }

      /* post a query to the server with target and get the data ports */
      function get_data_ports(target, command) {
          const url = "/DataPorts/" + command;
          var getResponders = $.post( url, { Target : target } )
              .done(function( data ) {
                  if (data) {
                      if (command == 'Configuration') {
                          document.getElementById("frame_src").src = "configuration.html?target=" + target;
                          document.getElementById("frame_modal_title").innerHTML="Configuration[" + target +"]";
                          $('#frame_modal').modal('show');
                      } else if (command == 'Statistics') {
                          document.getElementById("frame_src").src = "statistics.html?target=" + target;
                          document.getElementById("frame_modal_title").innerHTML="Statistics[" + target +"]";
                          $('#frame_modal').modal('show');
                      } else {
                          var result = '';
                          for (var key of Object.keys(data)) {
                              result += key + ' : ' + data[key] + '<br>';
                          }

                          document.getElementById("short_text_modal_title").innerHTML="Data Ports[" + target + ", " + command +"]";
                          document.getElementById("short_text_modal_data").innerHTML=result;
                          $('#short_text_modal').modal('show');
                      }
                  } else {
                      document.getElementById("short_text_modal_title").innerHTML="Data Ports[" + target + ", " + command +"]";
                      document.getElementById("short_text_modal_data").innerHTML="NULL";
                      $('#short_text_modal').modal('show');
                  }
              });
      }

      /* post a query to the server with Data ports list */
      $.post( "/DataPorts/List", { } ).done(function( data ) {
          for(command in data["Commands"]) {
              $( "#DataPortsTableHeader" ).append('<th>' + data["Commands"][command] + '</th>');
          }

          var TableData = [];
          for(target in data["Items"]) {
              var TableRow = [data["Items"][target]];
              for(command in data["Commands"]) {
                  const row = '<a href="javascript:void(0);" onclick="get_data_ports(\'' + data["Items"][target] + '\', \'' + data["Commands"][command] + '\');">' + data["Commands"][command] + '</a>'
                  TableRow.push(row);
              }
              TableData.push(TableRow);
          }
          $('#DataPortsTable').dataTable({ "data": TableData });
      });

      /* post a query to the server with Data connectors list */
      $.post( "/DataConnectors/List", { } ).done(function( data ) {
          for(command in data["Commands"]) {
              $( "#DataConnectorsTableHeader" ).append('<th>' + data["Commands"][command] + '</th>');
          }

          var TableData = [];
          for(target in data["Items"])
          {
              var TableRow = [data["Items"][target]];
              for(command in data["Commands"])
              {
                  TableRow.push('<a href="' + data["Commands"][command] + '.html#/DataConnectors/' + data["Items"][target] + '">' + data["Commands"][command] + '</a>');
              }
              TableData.push(TableRow);
          }
          $('#DataConnectorsTable').dataTable({"data": TableData });
      });

      </script>
  </body>
</html>
