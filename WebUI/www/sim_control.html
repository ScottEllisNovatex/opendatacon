<!DOCTYPE html>
<html lang="en">
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OpenDataCon</title>

    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css">

    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="/node_modules/popper/dist/umd/popper.min.js"></script>
    <script src="/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

    <script>
      $(function() {
          $("#common_content").load("common.html");
      });
    </script>
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-2">
          <div class="dropdown">
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
              Point Type
            </button>

            <div class="dropdown-menu">
              <div id="point_types">
              </div>
            </div>
          </div>
        </div>

        <div class="col-sm-10">
          <div class="dropdown">
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" onclick="init_indexes()">
              Index
            </button>

            <div class="dropdown-menu">
              <div id="indexes">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      var point_type = null;
      var index_value = null
      $(document).ready(function() {
          const target = "DNP3Outstation";
          $.post("/DataPorts/CurrentState", {Target : target})
              .done(function(data) {
                  for (var key of Object.keys(data)) {
                      const item = '<a class="dropdown-item" onclick="set_point_type(\'' + key + '\');">' + key + '</a>'
                      document.getElementById("point_types").innerHTML += item;
                  }
              });
      });

      function set_point_type(type) {
          point_type = type;
      }

      function init_indexes() {
          const target = "DNP3Outstation";
          $.post("/DataPorts/CurrentState", {Target : target})
              .done(function(data) {
                  if (point_type) {
                      var item = '<a class="dropdown-item" onclick="set_index(all)"> all </a>'
                      document.getElementById("indexes").innerHTML = item;
                      for (var key of Object.keys(data[point_type])) {
                          item = '<a class="dropdown-item" onclick="set_index(\'' + key + '\');">' + key + '</a>'
                          document.getElementById("indexes").innerHTML += item;
                      }
                  }
              });
      }

      function set_index(index) {
          index_value = index;
      }

      </script>
  </body>
</html>
