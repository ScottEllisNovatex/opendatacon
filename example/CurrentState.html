<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>Current State</title>
        <script src="/js/jquery-1.11.1.min.js"></script>
		<script src="/js/JsonDiff.js"></script>
		<link href="/css/odc.css" rel="stylesheet">        
		<link href="/css/jquery.treetable.css" rel="stylesheet" type="text/css" />
		<link href="/css/jquery.treetable.theme.css" rel="stylesheet" />
		<script src="/js/jquery.treetable.js"></script>				
    </head>
    <body>
        <h1>Current State</h1>
        <div id="CurrentStateDiv"></div>
        <h1>Mimic</h1>
        <svg id="mimic-svg" xmlns="http://www.w3.org/2000/svg"    width="705.80011"
   height="848.36243"></svg>
        <script>
        	var urlhash = window.location.hash.substring(1);
        	var hasharray = urlhash.split( '/' );
        	
        	var responder = hasharray[1];
        	var target = hasharray[2];
        	var command = "CurrentState";
        	var posturl = responder + "/" + command;
        	
        	function updateMimic(mimic, data)
			  {
			  	mimic.getElementById("Amps_A").getElementsByTagName('tspan')[0].textContent = data.AnalogCurrent[0];
			  	mimic.getElementById("Amps_B").getElementsByTagName('tspan')[0].textContent = data.AnalogCurrent[1];
			  	mimic.getElementById("Amps_C").getElementsByTagName('tspan')[0].textContent = data.AnalogCurrent[2];
			  	mimic.getElementById("Voltage_230V_Aph").getElementsByTagName('tspan')[0].textContent = data.AnalogCurrent[3];
			  	mimic.getElementById("Voltage_230V_Bph").getElementsByTagName('tspan')[0].textContent = data.AnalogCurrent[4];
			  	mimic.getElementById("Voltage_230V_Cph").getElementsByTagName('tspan')[0].textContent = data.AnalogCurrent[5];
				mimic.getElementById("Switch1_Open").setAttributeNS(null, 'visibility', data.BinaryCurrent[0] ? 'hidden' : 'visible');
			  	mimic.getElementById("Switch1_Closed").setAttributeNS(null, 'visibility', data.BinaryCurrent[0] ? 'visible' : 'hidden');;
				mimic.getElementById("Switch2_Open").setAttributeNS(null, 'visibility', data.BinaryCurrent[1] ? 'hidden' : 'visible');
			  	mimic.getElementById("Switch2_Closed").setAttributeNS(null, 'visibility', data.BinaryCurrent[1] ? 'visible' : 'hidden');;
			  }
        	
        	function refreshValues(posturl, target)
        	{
				var getResponders = $.post( posturl, { Target : target } )
					.done(function( data ) {
						var statediv = document.getElementById("CurrentStateDiv");
						$(statediv).empty();
						var statetable = document.createElement('table');
						statediv.appendChild(statetable);
						BuildJsonTree(statetable, "", {"Value" : data});
						$(statetable).treetable({ expandable: true });
						updateMimic(document.getElementById("mimic-svg"), data);
					});
        	}
        	
            // Send the data using post
            $( document ).ready(function() {
				$('#mimic-svg').load('mimic-dmc.svg', null, function() { 
					refreshValues(posturl, target);
					setInterval(function(){refreshValues(posturl, target);}, 1000);
				});            
            });
        </script>
    </body>
</html>